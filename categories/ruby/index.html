<!DOCTYPE html>
<html>
    <head><title>Ruby - Maksym Prokopov personal blog</title>
<meta charset="utf-8"/>
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta name="viewport" content="width=device-width, initial-scale=1">



<script>
 var remark_config = {
   host: 'https://remark.prokopov.me',
   site_id: 'remark',
   no_footer: true
 }
</script>
<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>


<link rel="stylesheet" href="https://prokopov.me/style.min.24166a1e761f51442033103dc963330d3526a4339a58ab46d3fee0c94a62f4a3.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
<script type='text' src='https://platform.linkedin.com/badges/js/profile.js' async defer ></script>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                                                      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                                                                                                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                                                                                                    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
 })(window,document,'script','dataLayer','GTM-WB9KBZ5');</script>

<script defer data-domain="prokopov.me" src="https://analytics.prokopov.me/js/script.js"></script>
</head>
    <body><div class="header">
    <a class="title" href="/"><div id="title">Maksym Prokopov personal blog</div><div id="description">Idea is a something worth sharing</div></a>
</div>
<div class="nav">
    
    <div class="page-item"><a href="https://prokopov.me/pages/projects/">Projects</a></div>
    
    <div class="page-item"><a href="https://prokopov.me/pages/talks/">Talks</a></div>
    
    <div class="page-item"><a href="https://prokopov.me/pages/about/">About</a></div>
    
</div>


<div class="article">
    <h1>
        <a href="https://prokopov.me/posts/ruby-macos-install/">Install Ruby 3.1.4 on macOS</a>
    </h1>
    <div class="date">29.08.2023</div>
    <div><p>In case ruby can&rsquo;t find OpenSSL 3 headers, use this way.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>brew install ruby-install
</span></span><span style="display:flex;"><span>ruby-install ruby 3.1.4 -- --with-openssl-dir<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>brew --prefix openssl<span style="color:#66d9ef">)</span>
</span></span></code></pre></div></div>
</div>

<div class="article">
    <h1>
        <a href="https://prokopov.me/posts/@mprokopov/how-to-improve-ruby-code-with-dup-and-tap-methods-95fa1d1bb9fe/">How to improve ruby code with dup and tap methods</a>
    </h1>
    <div class="date">06.06.2018</div>
    <div><p>Here is a piece of my old code, but it’s definitely could be improved.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_params</span>
</span></span><span style="display:flex;"><span>  h <span style="color:#f92672">=</span> ticket_params
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">[</span><span style="color:#e6db74">:activity</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> extract_activity <span style="color:#66d9ef">if</span> extract_activity
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">[</span><span style="color:#e6db74">:event</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> extract_event <span style="color:#66d9ef">if</span> extract_event
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">:state_event</span>)
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">:activities_attributes</span>)
</span></span><span style="display:flex;"><span>  h
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>As you can see here, ‘h’ variable name is quite uncommunicative. Could it be refactored?</p>
<p>Let’s see, <code>h=ticket_params</code>. We call this because we don’t want to modify <code>ticket_params</code>. Is there any method which creates a copy?</p>
<p>It turns out we have dup method which creates a copy of an object, this is exactly what we wanted. Then, we have tap method, which allows us to dive in object internals and return then itself. Here is whole new piece of code after refactoring.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_params</span>
</span></span><span style="display:flex;"><span>  ticket_params<span style="color:#f92672">.</span>dup<span style="color:#f92672">.</span>tap <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>params<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    params<span style="color:#f92672">[</span><span style="color:#e6db74">:activity</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> extract_activity <span style="color:#66d9ef">if</span> extract_activity
</span></span><span style="display:flex;"><span>    params<span style="color:#f92672">[</span><span style="color:#e6db74">:event</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> extract_event <span style="color:#66d9ef">if</span> extract_event
</span></span><span style="display:flex;"><span>    params<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">:state_event</span>)
</span></span><span style="display:flex;"><span>    params<span style="color:#f92672">.</span>delete(<span style="color:#e6db74">:activities_attributes</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>Much better now and we do not have any redundant variable!</p>
</div>
</div>




<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WB9KBZ5"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

</body>
</html>
