<!DOCTYPE html>
<html>
    <head><title>Maksym Prokopov personal blog</title>
<meta charset="utf-8"/>
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport">
<meta name="viewport" content="width=device-width, initial-scale=1">



<link rel="stylesheet" href="https://prokopov.me/style.min.447e017611b97f06eb4e1aafcb725572705000fc310bd68929c6905d8fc2a6c0.css">
<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
    <body><div id="header">
    <a class="title" href="/"><div id="title">Maksym Prokopov personal blog</div><div id="description">Idea is a something worth sharing</div></a>
</div>
<div class="nav">
    
    <div class="page-item"><a href="https://prokopov.me/pages/trips/">Travel</a></div>
    
    <div class="page-item"><a href="https://prokopov.me/pages/reading/">Read</a></div>
    
    <div class="page-item"><a href="https://prokopov.me/pages/creating/">Create</a></div>
    
    <div class="page-item"><a href="https://prokopov.me/pages/about/">About</a></div>
    
</div>

<div class="article">
    <h1>
        <a href="https://prokopov.me/posts/mprokopov/deployment-of-clojure-app-to-production-with-docker-9dbffeac6ef5/">Deployment of Clojure app to a production with Docker</a>
    </h1>
    <div class="date">03.08.2017</div>
    
    <h4>Reading time: 3 min.</h4>
    
    <div><p>Clojure deployment to a production itself not a very complicated task, but with the Docker it becomes more flexible solution. You can deploy your app to the Amazon EC2 or even to Amazon EC2 Container Service just in minutes! In this example we have Ring <strong>web server</strong> listening on <strong>3000 port</strong> an some public resources, like bootstrap css and js in resources/public folder, and application-specific settings in resources/settings folder.</p>
<p><strong>Caution:</strong> your Ring web server should be configured to listen on 0.0.0.0 address in order to play nicely with docker.</p>
<p>First, assume we will deploy to the production compiled app as an executable uberjar file. So, you should make sure that your application can be compiled with command</p>
<p>lein uberjar</p>
<p>this will produce the new JAR file in the <strong>target</strong> folder, like following <strong>target/clojure-workshop-0.1.0-SNAPSHOT-standalone.jar</strong>.</p>
<p>Check that your executable is running</p>
<p>java -jar target/clojure-workshop-0.1.0-SNAPSHOT-standalone.jar</p>
<p>this should run your Clojure application. Keep in mind, that the entrypoint in your application is specified in <strong>project.clj</strong> file. In the <strong>clojure-workshop.core</strong> you should have private <strong>“main”</strong> function defined.</p>
<p>:main clojure-workshop.core</p>
<p>In case all above is okay, you can proceed with the Dockerfile creation.</p>
<h3 id="creation-of-the-docker-container">Creation of the docker container</h3>
<p>FROM java:8-alpine<br>
RUN mkdir -p /app /app/resources<br>
WORKDIR /app<br>
COPY target/uberjar/*-standalone.jar .<br>
COPY resources/public resources/public<br>
CMD java -jar clojure-workshop-0.1.0-SNAPSHOT-standalone.jar<br>
EXPOSE 3000</p>
<p>Then build and tag your image</p>
<p>docker build -t mprokopov/clojure-workshop .</p>
<p>And try to launch</p>
<p>docker run -p 3000:3000 mprokopov/clojure-workshop</p>
<p>In case you did everything right you can enjoy your app response in browser <a href="http://localhost:3000">http://localhost:3000</a>. Keep in mind, that the docker assigns different internal network addresses for running containers, so you should configure your Ring web server to listen on the <strong>‘0.0.0.0’</strong> address.</p>
<h3 id="deployment-to-the-production">Deployment to the production</h3>
<p>Then your task is to deploy to the production. Let’s say you have a docker repository, for instance, in the Dockerhub. Push your image there.</p>
<p>docker push mprokopov/clojure-workshop</p>
<p>Spin off your virtual server instance and login to your remote server via ssh, ensure you have docker instance running with <strong>‘docker ps’</strong>, if not, install docker service. Then we can continue</p>
<p>docker pull mprokopov/clojure-workshop</p>
<p>If you decide to have nice looking <strong>docker-composer.yaml</strong>, this could be your example how to create one:</p>
<p>services:<br>
srv:<br>
build: .<br>
image: mprokopov/clojure-workshop<br>
volumes:<br>
- ./resources/settings:/app/resources/settings<br>
ports:<br>
- 3000:3000<br>
restart: always</p>
<p>See that settings volume? In this way you can store your sensitive or permanent data outside of the ephemeral container to survive between container spin-offs.</p>
<p>docker-compose up -d</p>
<p>If you need nginx-proxy before your container you can enjoy <a href="https://github.com/jwilder/nginx-proxy">jwilder/nginx-proxy</a> container, then your docker-compose should include VIRTUAL_HOST env variable.</p>
<p>services:<br>
srv:<br>
build: .<br>
image: mprokopov/clojure-workshop<br>
environment:<br>
VIRTUAL_HOST=mydomain.com<br>
volumes:<br>
- ./resources/settings:/app/resources/settings<br>
ports:<br>
- 3000:3000<br>
restart: always</p>
<p>After this you can open <a href="http://mydomain.com">http://mydomain.com</a> and enjoy your Clojure application in production with <strong>nginx-proxy</strong>.</p>
</div>
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    this.page.url =  null ;  
    this.page.identifier =  null ; 
    };
 (function() {
     var d = document, s = d.createElement('script');
     s.src = 'https://maksym-prokopov-personal-blog.disqus.com/embed.js';
     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>
<div id="sidebar"><div class="sidebar__visitcard">
    <div class="sidebar__heading">Profile</div><p></p>
    <div class="textwidget">
        
        <a href="https://ru-ru.facebook.com/mprokopov" target="_TOP" style="font-family: &quot;lucida grande&quot;,tahoma,verdana,arial,sans-serif; font-size: 18px; font-variant: normal; font-style: normal; font-weight: normal; color: #3B5998; text-decoration: none;" title="Max Prokopov" rel="noopener noreferrer">Max Prokopov</a><br><a href="https://ru-ru.facebook.com/mprokopov" target="_TOP" title="Max Prokopov" rel="noopener noreferrer"><img src="https://badge.facebook.com/badge/564099895.8308.711585450.png" style="border: 0px;"></a>
        </div>
</div>
<div class="sidebar__categories">
    <div class="sidebar__heading">Categories</div>
    <p></p>
    <ul class="sidebar__links">
        
        <li><a href="/categories/ansible/">ansible</a> (1) </li>
        
        <li><a href="/categories/apache/">apache</a> (3) </li>
        
        <li><a href="/categories/clojure/">clojure</a> (1) </li>
        
        <li><a href="/categories/docker/">docker</a> (1) </li>
        
        <li><a href="/categories/education/">education</a> (2) </li>
        
        <li><a href="/categories/freebsd/">FreeBSD</a> (8) </li>
        
        <li><a href="/categories/gtd/">GTD</a> (4) </li>
        
        <li><a href="/categories/iphone/">iPhone</a> (4) </li>
        
        <li><a href="/categories/kubernetes/">kubernetes</a> (1) </li>
        
        <li><a href="/categories/lifehack/">lifehack</a> (24) </li>
        
        <li><a href="/categories/links/">links</a> (5) </li>
        
        <li><a href="/categories/linux/">linux</a> (1) </li>
        
        <li><a href="/categories/macos/">macos</a> (1) </li>
        
        <li><a href="/categories/rails/">rails</a> (1) </li>
        
        <li><a href="/categories/ruby/">ruby</a> (1) </li>
        
        <li><a href="/categories/sip/">sip</a> (1) </li>
        
        <li><a href="/categories/tips-and-tricks/">tips and tricks</a> (1) </li>
        
        <li><a href="/categories/vmware/">vmware</a> (2) </li>
        
        <li><a href="/categories/windows/">windows</a> (4) </li>
        
        <li><a href="/categories/%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/">администрирование</a> (32) </li>
        
        <li><a href="/categories/%D0%B1%D0%B5%D0%B7-%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B8/">без категории</a> (1) </li>
        
        <li><a href="/categories/%D0%B1%D1%8B%D1%82%D0%BE%D0%B2%D0%B0%D1%8F-%D1%82%D0%B5%D1%85%D0%BD%D0%B8%D0%BA%D0%B0/">бытовая техника</a> (3) </li>
        
        <li><a href="/categories/%D0%B2%D0%B5%D0%B1-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/">веб-разработка</a> (10) </li>
        
        <li><a href="/categories/%D0%B2%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F/">виртуализация</a> (1) </li>
        
        <li><a href="/categories/%D0%B3%D0%B0%D0%B4%D0%B6%D0%B5%D1%82%D1%8B/">гаджеты</a> (2) </li>
        
        <li><a href="/categories/%D0%B6%D0%B5%D0%BB%D0%B5%D0%B7%D0%BE/">железо</a> (3) </li>
        
        <li><a href="/categories/%D0%B7%D0%B0-%D0%B6%D0%B8%D0%B7%D0%BD%D1%8C/">за жизнь</a> (117) </li>
        
        <li><a href="/categories/%D0%B7%D0%B4%D0%BE%D1%80%D0%BE%D0%B2%D1%8C%D0%B5/">здоровье</a> (4) </li>
        
        <li><a href="/categories/%D0%BC%D0%B0%D0%BA/">Мак</a> (44) </li>
        
        <li><a href="/categories/%D0%BC%D0%B0%D1%80%D0%BA%D0%B5%D1%82%D0%B8%D0%BD%D0%B3/">маркетинг</a> (2) </li>
        
        <li><a href="/categories/%D1%81%D0%BE%D1%84%D1%82/">Софт</a> (25) </li>
        
        <li><a href="/categories/%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5/">управление</a> (1) </li>
        
        <li><a href="/categories/%D1%8E%D0%BC%D0%BE%D1%80/">Юмор</a> (6) </li>
        
    </ul>
</div>
<div class="sidebar__friends">
    <div class="sidebar__heading">Friends</div><p></p>
	<ul class="sidebar__links">
      
      <li><a href="https://it-premium.com.ua" title="Наш сайт по ИТ-аутсорсингу" >IT-Premium аутсорсинг от профессионалов</a></li>

      
      <li><a href="http://nexusonrails.blogspot.com/" title="Мой блог на blogger.com о Ruby on Rails" >Nexus on Rails</a></li>

      
      <li><a href="http://blog.it-premium.com.ua" title="Блог Максима Прокопова про Docker, Xen и CoreOS и всякое такое" rel="friend">Maksym Prokopov about Docker, Xen и CoreOS</a></li>

      
      <li><a href="http://nexus.org.ua" title="Сайт об IT технологиях" >Мой хардкорный убер сайт 2005 года Nexus Notes</a></li>

      
      <li><a href="http://condom.org.ua" title="Контрацепция в деталях" >Проект о контрацепции</a></li>

      
      <li><a href="https://super-truper.com.ua" title="Лучший интернет-магазин ручного инструмента Truper" >Интернет-магазин ручного инструмента Truper</a></li>

      
      <li><a href="http://asterisk.in.ua" title="Курсы и услуги по внедрению asterisk" >Asterisk.in.ua</a></li>

      
      <li><a href="http://it-premium.livejournal.com/" title="" rel="friend co-worker neighbor">IT-Premium company blog</a></li>

      
	</ul>
</div>
</div>


</body>
</html>
